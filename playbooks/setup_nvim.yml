---
- hosts: localhost
  connection: local
  vars:
    nvim_src: '~/dotfiles/files/nvim'
    nvim_dest: '~/.config/nvim'

  tasks:
    - block:
      - name: Apt add neovim-ppa repo
        apt_repository: repo='ppa:neovim-ppa/unstable'

      - name: Install neovim and dependencies
        apt: name={{ item }} state=latest update_cache=yes
        with_items:
          - python-dev
          - python-pip
          - python3-dev
          - python3-pip
          - neovim

      - name: Install neovim-python module
        pip: name=neovim state=latest executable=pip3
      become: yes

    - block:
      - name: Create directory for plug.vim
        file: path={{ nvim_dest }}/autoload state=directory

      - name: Grab plug.vim source and write to file
        get_url:
          url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
          dest: "{{ nvim_dest }}/autoload/plug.vim"
          thirsty: yes

      - name: Link nvim config files
        file: src={{ nvim_src }}/{{ item }}
              dest={{ nvim_dest }}/{{ item }}
              state=link
              force=yes
        with_items:
          - init.vim
          - nerdTreeColors.vim

      - name: Ensure snippets directory exists
        file: dest={{ nvim_dest }}/snippets state=directory

      - name: Link snippets
        file: src={{ item }}
              dest={{ nvim_dest }}/snippets/{{ item | basename }}
              state=link
              force=yes
        with_fileglob:
          - "{{ nvim_src }}/snippets/*"
      become: false
